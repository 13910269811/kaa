---
layout: page
title: Cluster setup guide
permalink: /:path/
nav: /:path/Administration-guide/System-installation/Cluster-setup
sort_idx: 30
---

# Cluster setup

In general claster setup is similar to single noode setup, exept few details. We need atleast 3 nodes to create a reliable cluster. For simplisity in this tutorial we will be using single SQL and NoSQL databases, so this tutorial doesn't cover such tems like setting up Cassandra, MongoDB od PostgresSql claster setup. So let say that we have 3 nodes with Ubuntu 14.04 installed on each of them.

```bash
node1 172.1.1.1
node2 172.2.2.2 
node3 172.3.3.3
```

On every of them we had succesfully instaled kaa and everithing that left it is to cinfigure kaa-node services.

## List of properties

To set up claster it is necessary to edit next properties:
 
 | Property name | Example values | Description | File location | 
 |-------------- |--------------- |------------ |-------------- |
 | control_server_enabled | true/false | Determines whether control server enabled on this node or not | /usr/lib/kaa-node/conf/kaa-node.properties |
 | bootstrap_server_enabled | true/false | Determines whether bootstrap server enabled on this node or not  | /usr/lib/kaa-node/conf/kaa-node.properties |
 | operations_server_enabled | true/false | Determines whether operations server enabled on this node or not | /usr/lib/kaa-node/conf/kaa-node.properties |
 | zk_host_port_list | localhost:2181, anotherhost:2181 | Comma-separated list of Zookeeper nodes hostname:port | /usr/lib/kaa-node/conf/kaa-node.properties |
 | node id | 1-255 | single line of text that represents node id | /var/lib/zookeeper/myid |
 | jdbc_host | localhost | PostgreSQL database hostname | /usr/lib/kaa-node/conf/dao.properties, /usr/lib/kaa-node/conf/admin-dao.properties |
 | jdbc_port | 5432 | PostgreSQL database port | /usr/lib/kaa-node/conf/dao.properties, /usr/lib/kaa-node/conf/admin-dao.properties |
 | nosql_db_provider_name | cassandra/mongodb | Determines whether Cassandra or MongoDB provider will be used | /usr/lib/kaa-node/conf/dao.properties |
 | node_list | localhost:9042, ... | Comma-separated list of Cassandra nodes hostname:port | /usr/lib/kaa-node/conf/common-dao-cassandra.properties |
 | servers | localhost:27017, ... | Comma-separated list of MongoDB nodes hostname:port | /usr/lib/kaa-node/conf/common-dao-mongodb.properties |
 

After Kaa installation on Ubuntu/Debian OS (deb packages), configuration files for each Kaa component will be extracted into the
/usr/lib/kaa-{component-name}/conf or /etc/kaa-{component-name}/conf directories. We are interested in 3 configuration files.

Before starting configuration stop kaa-node service byu executing next command

```bash
 $ sudo service kaa-node stop
```

Kaa services (bootstrap, control or operations) on our node by editing corresponding properties in 
```/usr/lib/kaa-node/conf/kaa-node.properties``` file.

```bash
# Specifies if Control Server is enabled.
control_server_enabled=true

# Specifies if Bootstrap Server is enabled.
bootstrap_server_enabled=true

# Specifies if Operations Server is enabled.
operations_server_enabled=true
```

Kaa-node transport properties, in this properties we need to specifie IP address of current node.

```bash
 # The Control Server notifies every Operations/Bootstrap Server on most data updates via a Thrift-based protocol.

 # Thrift server host
 thrift_host=<ip_of_current_machine>

 # Interface that will be reported by all transports
 transport_public_interface=<ip_of_current_machine>
```

Kaa zookeeper hosts - list of all zookeeper services on nodes.

```bash
 # Zookeeper service url list.
 zk_host_port_list=<zookeeper_ip>:<zookeeper_port>
```

For every node insert node id in file ```/var/lib/zookeeper/myid```. The myid file consists of a single line containing only the text of that machine's id. So myid of server 1 would contain the text "1" and nothing else. The id must be unique within the ensemble and should have a value between 1 and 255. For example we have 3 nodes so we will have next values 1, 2, 3. For more details visit this [documentation page](https://zookeeper.apache.org/doc/r3.3.2/zookeeperAdmin.html#sc_zkMulitServerSetup).

Configure SQL database host and port ```/usr/lib/kaa-node/conf/dao.properties```

```bash
 # specify jdbc database host
 jdbc_host=<postgresql_ip>
 
 # specify jdbc database post
 jdbc_port=<postgresql_port>
```

and ```/usr/lib/kaa-node/conf/admin-dao.properties```

```bash
 # specify jdbc database url
 jdbc_url=jdbc:postgresql://<postgresql_ip>:<postgresql_port>/kaa
```

Select NoSQL database ```mongo``` or ```cassandra```in ```/usr/lib/kaa-node/conf/dao.properties``` file.

```bash
 # NoSQL database provider name, autogenerated when mongo-dao or cassandra-dao profile is activated
 # Possible options: mongodb, cassandra
 nosql_db_provider_name=mongodb
```

Setup Cassandra host ip ```/usr/lib/kaa-node/conf/common-dao-cassandra.properties```

```bash
 # Specify node list
node_list=<cassandra_database_ip>:<cassandra_database_port>
```

Setup MongoDB host IP ```/usr/lib/kaa-node/conf/common-dao-mongodb.properties```

```bash
 # list of mongodb nodes, possible to use multiply servers
 servers=<mongo_database_ip>:<mongo_database_port>
```

After all 

```bash
 $ sudo service kaa-node start
```





